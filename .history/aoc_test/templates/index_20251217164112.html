<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>数据准备控制台</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='libs/flatpickr.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

    <!-- 顶部操作区 -->
    <div class="top-selects">
        <label>项目：</label>
        <select id="projectSelect"></select>

        <label>站点：</label>
        <div class="station-input-row">
            <input list="stationList" id="stationSelect" placeholder="输入或选择站点..." onkeydown="onStationInputKeydown(event)">
            <datalist id="stationList"></datalist>
            <button class="btn" onclick="addStationFromInput()">添加站点</button>
            <button class="btn delete-btn btn-outline-red" onclick="clearStationList()">清空列表</button>
        </div>
    </div>

    <!-- 站点标签展示区 -->
    <div class="station-tag-wrapper">
        <div id="stationTags" class="station-tags-container"></div>
    </div>

    <!-- 任务看板 -->
    <div class="section">
        <h3>数据下载</h3>
        <table>
            <thead>
                <tr>
                    <th scope="col" class="th-task-type">数据类型</th>
                    <th scope="col" class="th-task-time">时间范围</th>
                    <th scope="col" class="th-task-status">状态</th>
                    <th scope="col" class="th-task-progress">进度</th>
                    <th scope="col" class="th-task-action">操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>PWV 数据</strong></td>
                    <td id="pwvTimeRange">-</td>
                    <td id="pwvStatus"><span class="text-status-placeholder">未操作</span></td>
                    <td><div class="progress-bar"><div class="progress" style="width:0%"></div></div></td>
                    <!-- 操作列合并 -->
                    <td rowspan="3" class="cell-operation-merged">
                        <div class="operation-container">
                            <div class="upload-column col-upload-group">
                                <button class="btn upload-btn" onclick="openUploadModal('pwv')">⬆ PWV</button>
                                <button class="btn upload-btn" onclick="openUploadModal('weather')">⬆ 气象</button>
                                <button class="btn upload-btn" onclick="openUploadModal('rain')">⬆ 雨量</button>
                            </div>
                            <div class="download-column col-download-group">
                                <button class="btn download-btn" onclick="openUnifiedDownloadModal()">⬇ 下载整合</button>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><strong>气象数据</strong></td>
                    <td id="weatherTimeRange">-</td>
                    <td id="weatherStatus"><span class="text-status-placeholder">未操作</span></td>
                    <td><div class="progress-bar"><div class="progress" style="width:0%"></div></div></td>
                </tr>
                <tr>
                    <td><strong>雨量数据</strong></td>
                    <td id="rainTimeRange">-</td>
                    <td id="rainStatus"><span class="text-status-placeholder">未操作</span></td>
                    <td><div class="progress-bar"><div class="progress" style="width:0%"></div></div></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 数据列表 -->
    <div class="section">
        <h3>数据结果</h3>
        <table>
            <thead>
                <tr>
                    <th scope="col" class="th-ds-name">数据集名称</th>
                    <th scope="col" class="th-ds-id">站点编号</th>
                    <th scope="col" class="th-ds-site">站点名称</th>
                    

                    <th scope="col" class="th-ds-count">样本数量</th>
                    <th scope="col" class="th-ds-created">创建时间</th>
                    <th scope="col" class="th-ds-action">操作</th>
                </tr>
            </thead>
            <tbody id="datasetTableBody"></tbody>
        </table>
        <div class="dataset-footer">
            <div id="datasetCount" class="footer-info"></div>
            <div class="pagination" id="datasetPagination"></div>
        </div>
    </div>

</div>

<!-- 通用弹框 -->
<div class="modal-bg" id="modalBg">
    <div class="modal">
        <div id="modalBody"></div>
        <div id="modalFooter" class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">关闭</button>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='libs/flatpickr.min.js') }}"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>