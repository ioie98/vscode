# 使用轻量级 Python 基础镜像
FROM python:3.10-slim

# 设置工作目录
WORKDIR /app

# 设置系统时区为东八区（上海）
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' >/etc/timezone

# 先复制依赖文件，利用 Docker 层缓存优化构建速度
COPY requirements.txt .

# 安装依赖
# 使用阿里云镜像源加速安装（如果在国内构建）
RUN pip install --no-cache-dir -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/

# 复制当前目录下的所有文件（包括 main.py 和 static 目录）到镜像中
COPY . .

# 创建必要的目录（虽然脚本里有 os.makedirs，但在 Dockerfile 里创建更规范）
RUN mkdir -p /app/tmp /app/static

# 设置环境变量默认值（也可以在运行时通过 -e 覆盖）
ENV TOS_ACCESS_KEY=""
ENV TOS_SECRET_KEY=""

# 运行脚本
CMD ["python", "download_stations.py"]