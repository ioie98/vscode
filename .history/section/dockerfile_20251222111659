# 1. 使用国内镜像源的基础镜像
FROM docker.m.daocloud.io/library/python:3.10-slim

# 2. 设置工作目录
WORKDIR /app

# 3. 设置系统时区为中国上海
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' >/etc/timezone

# 4. 复制依赖文件并安装
COPY requirements.txt .

# 增加 --default-timeout=1000，并将源换为清华源 (通常比阿里更稳)
RUN pip install --no-cache-dir --default-timeout=1000 -r requirements.txt \
    -i https://pypi.tuna.tsinghua.edu.cn/simple

# 5. 复制项目文件
COPY . .

# 6. 创建临时数据目录并设置权限
RUN mkdir -p /app/tmp /app/static && chmod 777 /app/tmp

# 7. 设置环境变量默认值 (可以在 docker run 时通过 -e 覆盖)
ENV TOS_ACCESS_KEY=""
ENV TOS_SECRET_KEY=""

# 8. 运行脚本        
CMD ["python", "dags/download_stations.py"]