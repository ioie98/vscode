# 1. 使用国内镜像源的基础镜像 (双重保险)
FROM docker.m.daocloud.io/library/python:3.10-slim

# 2. 设置工作目录
WORKDIR /app

# 3. 设置系统时区为中国上海
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' >/etc/timezone

# 4. 复制依赖文件并安装 (使用阿里云 PyPI 镜像加速)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/

# 5. 复制项目文件 (确保本地有 static 文件夹)
COPY . .

# 6. 创建临时数据目录并设置权限
RUN mkdir -p /app/tmp /app/static && chmod 777 /app/tmp

# 7. 设置环境变量默认值 (可以在 docker run 时通过 -e 覆盖)
ENV TOS_ACCESS_KEY=""
ENV TOS_SECRET_KEY=""

# 8. 运行脚本 (假设你的文件名是 main.py)
CMD ["python", "download_stations.py"]